//load view.js before running this
var apiUrl = "http://wow.iwanttorule.space:7001";

var internetOff = false;

var app = {
  userId: null,


  Init: function() {
  	app.GetUserId(function(){
  		view.SetupView(app.GetDisplay);
  	});
  },


  GetUserId:function(callback) {
    AjaxCall("/join", {sendState: false}, function(data) {
      userId = data.id;
      CallCallback(callback);
    });
  },
  GetDisplay: function(callback) {
  	AjaxCall("/sendState", {id: userId}, function(data){
      view.Draw(data.world);
  		CallCallback(callback);
  	});
  },
  SendCommand: function(command){
  	AjaxCall("/action", {id: userId, action: command, sendState:true}, function(data){ 
      view.Draw(data.world);
  	});
  }
}

function CallCallback (callback){
  if(callback != null) {
    callback();
  }
}


function AjaxCall(endpoint, data, callback){
  if(internetOff){
    callback(testData);    
  }

  var ajax = $.ajax({
    method: "GET",
    url: apiUrl + endpoint,
    data: data,
  });
  ajax.done(function(data) {
    console.log("from " + apiUrl + endpoint + " returned: " + data);
    callback(data);
  });
  ajax.fail(function(req, status, error){
    console.log("bad req to " + apiUrl + endpoint + ":  " + status + " | " + error);
  });
}

var testData = 
{
  "id": "b97bdb1a-b910-4c7e-b0f4-34f02e1851d6", 
  "world": [
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#", 
      "#"
    ], 
    [
      "h", 
      "e", 
      "a", 
      "l", 
      "t", 
      "h", 
      ":", 
      " ", 
      "1", 
      "0", 
      "0", 
      " ", 
      "o", 
      "r", 
      "e", 
      ":", 
      " ", 
      "0", 
      " ", 
      "x", 
      ":", 
      " ", 
      "2", 
      "0", 
      " ", 
      "y", 
      ":", 
      " ", 
      "8", 
      " ", 
      " ", 
      " "
    ]
  ]
}

$(app.Init);
